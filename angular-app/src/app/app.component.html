<div class="container">
  <h1>Finance Manager</h1>

  <h2>Transactions</h2>
  <table>
    <thead>
      <tr>
        <th>Description</th>
        <th>Amount</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let transaction of transactions">
        <td>{{ transaction.description }}</td>
        <td [ngClass]="{'negative': transaction.amount < 0, 'positive': transaction.amount >= 0}">{{ transaction.amount | currency:'BRL' }}</td>
        <td>{{ transaction.date | date: 'dd/MM/yyyy' }}</td>


        <td>
          <button (click)="editTransaction(transaction)" class="btn-primary">Edit</button>
          <button (click)="deleteTransaction(transaction.id)" class="btn-delete">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
  <tfoot>
  <tr>
    <td><strong>Balance:</strong></td>
    <td  [ngClass]="{'negative': calculateBalance() < 0, 'positive': calculateBalance() >= 0}">{{ calculateBalance() | currency:'BRL' }}</td>
    <td></td>
    <td></td>
  </tr>
  </tfoot>

  <form *ngIf="!editingTransaction" (ngSubmit)="addTransaction()" #transactionForm="ngForm">
    <h2>Add Transaction</h2>
    <div class="form-row">
      <div class="form-group">
        <label>Date:</label>
        <input type="date" [(ngModel)]="newTransaction.date" name="date" required pattern="\d{4}-\d{2}-\d{2}" #dateInput="ngModel">
        <div *ngIf="dateInput.invalid">
          <small class="error" *ngIf="transactionForm.controls['date'].hasError('required')">Date is required.</small>
          <small class="error" *ngIf="transactionForm.controls['date'].hasError('pattern')">Please enter a valid date.</small>
        </div>
      </div>

      <div class="form-group">
        <label>Description:</label>
        <input [(ngModel)]="newTransaction.description" name="description" required #descriptionInput="ngModel">
        <div *ngIf="descriptionInput.invalid " class="error">
          <small class="error" *ngIf="descriptionInput.errors?.['required']">Description is required.</small>
        </div>
      </div>

      <div class="form-group">
        <label>Amount:</label>
        <input type="number" [(ngModel)]="newTransaction.amount" name="amount" required pattern="^-?(?!0(\.0+)?$)\d+(\.\d{1,2})?$" #amountInput="ngModel">
        <div *ngIf="amountInput.invalid">
          <small class="error" *ngIf="transactionForm.controls['amount'].hasError('required')">Amount is required.</small>
          <small class="error" *ngIf="transactionForm.controls['amount'].hasError('pattern')">Amount its required and can't be 0.</small>
        </div>
      </div>

      <div class="form-group">
        <button type="submit" class="btn-primary">Add</button>
        <div *ngIf="transactionForm.form.invalid && (transactionForm.submitted || transactionForm.dirty)" class="error">
          Please fill in all required fields.
        </div>
      </div>
    </div>
  </form>

  <form *ngIf="editingTransaction" (ngSubmit)="saveTransaction()">
    <h2>Edit Transaction</h2>
    <div class="form-row">
      <div class="form-group">
        <label>Date:</label>
        <input type="date" [(ngModel)]="editingTransaction.date" name="date" required>
      </div>

      <div class="form-group">
        <label>Description:</label>
        <input type="text" [(ngModel)]="editingTransaction.description" name="description" required>
      </div>

      <div class="form-group">
        <label>Amount:</label>
        <input type="number" [(ngModel)]="editingTransaction.amount" name="amount" required>
      </div>

      <div class="form-group">
        <button type="submit" class="btn-primary">Update</button>
        <button (click)="cancelEditing()" class="btn-delete">Cancel</button>
      </div>
    </div>
  </form>

  <hr>


</div>
